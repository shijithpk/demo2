<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<head>

<style>

@import url(https://fonts.googleapis.com/css?family=PT+Sans:400,700);

body{
  background: #fff;
  max-width: 900px;
  margin: 0px auto;
  font-family: 'PT Sans', sans-serif;
  color:#3a403d;
}

#container{
  position: relative;
}

#sections{
  width: 340px;
}

#sections > div{

  background: white;
  opacity: .2;
/*  margin-bottom: 300px;*/ 
margin-bottom: 350px;
}

#sections > div:last-child{
  /* margin-bottom: 50px; */
  margin-bottom: 50px;
}

#sections > div.graph-scroll-active{
  opacity: 1;
}

#graph{
  margin-left: 40px;
  width: 500px;
  position: absolute;
  top: 0px;
  margin-left: 380px;
}

.graph-scroll-fixed #graph{
  position: fixed;
  top: 0px;
}

.graph-scroll-below #graph{
  bottom: 0px;
  top: auto;
}

@media (max-width: 925px)  {
  #graph{
    width: 100%;
    transform: translate(-50%, 0);
    margin-left: 50%;
  }

  #sections{
    position: relative;
    margin: 0px auto;
    padding-top: 400px;
  }

  #sections div{
    background: rgba(255,255,255,0.8); /* alpha parameter */
    padding: 10px;
/*     border: 1px solid;  */
    max-width: 400px;
    margin-bottom: 500px;
  }
}

h1{
  margin: 50px;
}

h1, h3, h4{
  text-align: center;
}

/*
svg{
border: 1px solid black;
}
*/

text {
  font-family: 'PT Sans', sans-serif;
        font-size: 15px;
        fill: #3a403d;
        font-weight: bold;
    }

text.value {
        fill: #3a403d;
        opacity:1;
    }

text.title {
/*  fill: #30b096;*/
fill: #3a403d;
          font-size:16px;
          font-weight: bold;
          line-height:20px;
    }

text.subtitle {
/*  fill: #30b096;*/
          fill: #3a403d;
          font-size:14px;
          font-weight: normal;
          line-height:18px;
    }

text.footnote{
  fill: #30b096;
          font-size:12px;
          font-weight: normal;
     }



a { 
  color: #3a403d;
}
/*  CSS code for tooltip from http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f */


/* Tooltip CSS */
.d3-tip {
line-height: 1.5;
font-size: 14px;
font-weight: 400;
font-family:"PT Sans", sans-serif;
padding: 6px;
/*background: rgba(58, 64, 61, 0.9); */
background: rgba(48, 176, 150, 1);
color: #fff;
border-radius: 1px;
text-align: left;
/*position: absolute;*/
pointer-events: none;

}


.details{
color:white;
    }

</style>

</head>

<body>

    <h3>High blood pressure, high blood sugar and obesity...in Indian villages?</h3>
    
    <!-- alternatives
      High BP, high sugar levels and high BMI... in rural India?
      Is rural life in India becoming more like urban India?
                                            ...what's up with that?
    -->
    <p style="margin-left:25px;margin-right:25px;">Problems such as obesity, high blood pressure and high blood sugar levels are commonly seen as a part of urban life, a result of the unhealthy diets and inactive lifestyles that most city dwellers lead. So why are there so many districts in India where rural men and women suffer these problems?</p>
    
    <p style="margin-left:25px;margin-right:25px;">According to data from the National Family Health Survey 2015-16 (NFHS), there are 335 districts in India, out of 644, where at least one in ten rural adults (aged between 15 and 49) are overweight. As for figures on blood pressure (BP), there are 178 districts in India where at least one in 10 rural adults have a high BP. Data on blood sugar levels reveals a relatively smaller problem. There are just 16 districts in India where at least one in 10 rural adults live with high blood sugar levels (BSL).</p>

    <p style="margin-left:25px;margin-right:25px;">How harmful are these conditions? High BP, if left unchecked, could lead to <a href="https://www.mayoclinic.org/diseases-conditions/high-blood-pressure/in-depth/high-blood-pressure/art-20045868">stroke, heart disease and kidney failure</a>. High BSL, on the other hand, could be a sign of <a href="https://medlineplus.gov/ency/article/003482.htm">diabetes and even pancreatic cancer</a>. In fact, these problems often appear together with obesity in a cluster of conditions called <a href="https://www.nhlbi.nih.gov/health/health-topics/topics/ms">'metabolic syndrome'</a>.</p>    
      
    <h4>&dArr; SCROLL DOWN TO BEGIN  &dArr;</h4>

<div id='container'>
<div id='graph'></div>
  <div id='sections'>
    
    <!-- SEC 1 -->
        <div>
          
          <p style="font-weight:bold;text-align:center;">Which districts are worst off?</p>

          <p>So how widespread are these health conditions among rural adults in various districts? What we will do for each of the three conditions -- obesity, high BP and high BSL -- is divide the country's districts into two halves. The worse half, the half where the condition is more prevalent among rural adults, will be in a darker shade <img src="images/shade_rect.png" style="width:19px;height:14px;"> on the map. Then we will examine which districts are common to all three maps and point out any significant patterns.</p>

        </div>

    <!-- SEC 2 -->

    <!-- code for making text bold <span style="font-weight:bold;">THE TEXT</span>  -->

        <div>
          
          <p style="font-weight:bold;text-align:center;">Where is rural obesity a problem?</p>
                   
          <p>The indicator used in the NFHS for obesity is the body mass index (BMI). A person is considered overweight or obese if they have a BMI greater than <a href="https://www.britannica.com/topic/body-mass-index">25 kg/m<sup>2</sup></a>. The districts of the country are divided into two halves on the map. The districts filled with a darker shade <img src="images/shade_rect.png" style="width:19px;height:14px;"> represent the worse half, the districts where more than 12.2% of rural men and 12.8% of rural women are overweight or obese. (These numbers represent the medians for rural men and women, respectively, after excluding the districts where there is insufficient or no data in NFHS 2015-16.)</p>

          <p>If we look at the map, we see that the districts with a bigger problem of overweight or obese rural adults are in southern India and parts of western and northern India. Digging deeper into the data, the district with the worst stats is Fatehgarh Sahib district in Punjab, marked on the map with <img src="images/ring_shape.png" style="width:14px;height:14px;">. Over there, an estimated 39% of rural men and 40% of rural women are either overweight or obese.</p>
      
      </div>

    <!-- SEC 3 -->
        <div>
          
          <p style="font-weight:bold;text-align:center;">Where is high BP an issue for rural adults?</p>

          <p>This is a map showing districts where a higher share of rural men and women live with high blood pressure (BP). A high BP is defined as a systolic BP greater than 140 mm of Hg and/or a diastolic BP greater than 90 mm of Hg (more on these terms <a href="https://www.britannica.com/science/blood-pressure">here</a>). The districts marked with a darker shade <img src="images/shade_rect.png" style="width:19px;height:14px;"> are the ones where more than 12.35% of rural men and 8.39% of rural women have high BP. (These values represent the medians for rural men and women, respectively, after excluding the districts where there is insufficient or no data in NFHS 2015-16.)</p>

          <p>Looking at the map, we see there is a clutch of districts from the northeastern states where high BP is more widespread among rural adults, compared to other parts of India. The data tells us that Tawang district in Arunachal Pradesh, marked on the map with <img src="images/ring_shape.png" style="width:14px;height:14px;">, has the worst stats in India when it comes to BP. In Tawang, an estimated 38.5% of rural men and 25.5% of rural women have high BP.</p>
      
      </div>

    <!-- SEC 4 -->
        <div>
          <p style="font-weight:bold;text-align:center;">Where is high blood sugar a problem for rural adults?</p>
          
          <p>A high blood sugar level (BSL) is defined as anything over <a href="https://www.britannica.com/topic/glucose-tolerance-test">140 mg/dl</a>. As mentioned earlier, the problem of high BSL isn't as widespread as high BP and obesity. But in places where it's a problem, we will see it gets pretty severe.</p>
          
          <p>The districts of the country are divided into two halves on the basis of how widespread high BSL is among rural adults. The districts in the worse half are the ones marked in a darker shade <img src="images/shade_rect.png" style="width:19px;height:14px;"> on the map. In these districts, more than 6.9% of rural men and 4.9% of rural women have a high BSL. (These values represent the medians for rural men and women, respectively, after excluding the districts where there is insufficient or no data in NFHS 2015-16.)</p>   
            
          <p>From the map, we see that high BSL is relatively more of a problem in districts of West Bengal, Odisha and along the western coast of India. In fact, the district with the worst stats when it comes to BSL is Kannur district in Kerala, marked with <img src="images/ring_shape.png" style="width:14px;height:14px;">. Over there, an estimated 24.6% of rural men and 12.2% of rural women have high BSL.</p>
       
      </div>
    
    <!-- SEC 5 -->
        <div>
          <p style="font-weight:bold;text-align:center;">Bringing it all together</p>
          
          <p>What this map does is show the districts the previous three maps have in common (which is why the intersection of the three circles on the map is shaded). So this map shows us the districts that were in the worse half for all three maps, meaning the three conditions -- obesity, high BP and high BSL -- are more widespread among rural adults in these districts than in other places.</p>

          <p>If we look at the figures, we find there are just 57 districts that all three maps have in common, but 13 of those 57 are in the states of Punjab and Himachal Pradesh, marked on the map with <img src="images/dashed_rect.png" style="width:19px;height:14px;">. So what is going on in these districts? Scroll down for a closer look at them. </p>
        
        </div>

    <!-- SEC 6 -->
        <div>
            <p style="font-weight:bold;text-align:center;">What's up with Punjab and HP?</p>
            
            <p>It is difficult to come to any concrete conclusion about why obesity, high BP and high blood sugar are more widespread among rural adults in these districts. One would need to consult a public health expert or an epidemiologist for more insight into this.</p> 
              
           <p>But if one were to speculate, one reason could be that because of how developed Punjab is, especially its agrarian sector, rural people here might have a higher income than rural people in most other places. So their standard of living might be closer to urban standards, and so they may be becoming as physically inactive and eating as poorly as city dwellers.</p>

           <p>Another reason could be that many of these districts have big cities such as Patiala, Jalandhar and Ludhiana. So many people who live in rural areas might actually be commuting to these cities for work and are a part of the urban economy, despite living in villages. So their lifestyles might be closer to that of urban people, but again this is all speculation. </p>

      </div>

  </div>
  
  <p style="margin-left:25px;margin-right:25px;">The prevalence of these supposedly 'urban' health conditions among rural people just serves to show how life in parts of rural India may not be as simple and spartan as we imagine it to be. The fact is that the term 'rural' is just a categorisation of the area people live in and it gives us only a partial idea of the lives people lead there.</p>

</div>


<script src="scripts/d3v4+jetpack.js"></script> 
<script src="scripts/graph-scroll.js"></script>
<script src="scripts/d3-geo.v1.min.js"></script>
<script src="scripts/d3-tip.js"></script>

<script>

var oldWidth = 0
function render(){

  if (oldWidth == innerWidth) return
  oldWidth = innerWidth 

  var width = d3.select('#graph').node().offsetWidth,
      height = innerWidth > 925 ? width : innerHeight * 0.9
      ;     


var svg = d3
            .select('#graph')
            .html('')
            .append('svg')
            .attrs({width: width, height: height})
            ;

function canvas_clear(){

svg
    .selectAll("*")
    .remove();
}





function sec_1(){  //all the dots together

      canvas_clear();

svg
            .append("svg:image")
            .attr("xlink:href","images/main_image.jpg")
            .attr('width', '500')
            .attr('height', '333')
            .attr("x", "0")             
            .attr("y", "0")
            ; 


}

function sec_2(){ 

      canvas_clear();

//text wrap code from https://bl.ocks.org/mbostock/7555321

      function wrap(text, width) {
  text.each(function() {
    var text = d3.select(this),
        words = text.text().split(/\s+/).reverse(),
        word,
        line = [],
        lineNumber = 0,
        lineHeight = 1.1, // ems
        x = text.attr("0"),
        y = text.attr("y"),
        dy = 0, //parseFloat(text.attr("dy")),
        tspan = text.text(null)
                    .append("tspan")
 //                   .attr("x", 10)
//                    .attr("x", x)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", dy + "em")
                    ;
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text
                    .append("tspan")
                    //.attr("x", 50)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", ++lineNumber * lineHeight + dy + "em")
                    .text(word)
                    ;
      }
    }
  });
}

svg
    .append('text')
    .attr('class','title')
    .attr('y', 20)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("MAPPING OBESITY IN RURAL ADULTS")
    //.call(wrap, 400)
    .transition()
    .duration(3000)
    .attr('opacity','1')
    ;

    svg
    .append('text')
  .attr('class','subtitle')
    .attr('y', 37)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("Hover over a district for more details")
    //.call(wrap, 400)
    .transition()
    .duration(3000)
    .attr('opacity','1')
    ;





d3.json("maps/district_map_merged.json", function(json){



  var format = d3.format(".2n");


//code for tooltip from http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f

  var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([75, 150])
            .html(function(d) {
              return "<strong>District: </strong>" + "<span class='details'>" + d.properties.district + "</span><br>" + "<strong>State: </strong>" + "<span class='details'>" + d.properties.state + "</span><br>" + "<strong>Rural men with high BMI: </strong>" + "<span class='details'>" + format(d.properties.rural_BMIM) +"%</span><br>"+ "<strong>Rural women with high BMI: </strong>" + "<span class='details'>" + format(d.properties.rural_BMIW) +"%</span>";
            })
            ;


var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

    map.call(tip);
             
    

      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            .style("stroke", "#fff")
            .style("stroke-width", "0px")
            .style("fill-opacity","1")

            .on('mouseover',function(d){
                if( d.properties.rural_BMI_show === 'yes'){
                         tip.show(d);

                          d3.select(this)
                            //.style("opacity", 1)
                            .style("stroke","#fff")
                            .style("stroke-width","2px");
                }
                        })
        .on('mouseout', function(d){
          if( d.properties.rural_BMI_show === 'yes'){

                         tip.hide(d);

                          d3.select(this)
                            //.style("opacity", 0.8)
                            .style("stroke","#fff")
                            .style("stroke-width","0px");
          }
        })
        .style('fill','#caf270')
        .transition()
                  .delay(function(d,i){console.log(i,d); return i * 3})
            .style("fill", function(d) {
              if( d.properties.rural_BMI_show === 'yes'){
				    	      return '#30b096';
				     } else {
				    	return '#caf270';	}					
               })
        ;

//used code from https://bl.ocks.org/ThomasThoren/7e9970f025c301e8c2f8 for the block below

    map.selectAll('circle')
        .data(json.features)
        .enter()
        .append('circle')
        .each(function(d) {
          if (d.properties.district !== 'Fatehgarh Sahib') {
            return;
          }
          d3.select(this)
            .attr("r", 4)
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr("fill", "none")
            .attr("stroke", "#3a403d")
            .attr("stroke-width", 2)
            .attr('stroke-opacity',0)
            .transition()
            .duration(3000)
            .attr('stroke-opacity',1)
            ;
        })
        ;

        map.selectAll('text')
        .data(json.features)
        .enter()
        .append('text')
        .each(function(d) {
          if (d.properties.district !== 'Fatehgarh Sahib') {
            return;
          }
          d3.select(this)
            .style('font-weight','normal')
            .style('font-size','14px')
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr('dx','10px')
            .style('text-anchor','start')
            .attr('opacity','0')
            .text(function(d){return d.properties.district})
            .transition()
            .duration(3000)
            .attr('opacity','1')
            ;
        })
        ;

map
  .append("rect")
    .attr("rx", 5)
    .attr("ry", 5)
    .attr("x", w*(4.5/7))
    .attr("y", h*(2/3))
    .attr("width", w/20)
    .attr("height", h/40)
    .style("fill", '#caf270')
    .attr('fill-opacity',1)
   ;

map
  .append("rect")
    .attr("rx", 5)
    .attr("ry", 5)
    .attr("x", w*(4.5/7))
    .attr("y", h*(4.25/6))
    .attr("width", w/20)
    .attr("height", h/40)
    .style("fill", '#30b096')
    .attr('fill-opacity',1)
   ;

map
        .append('text')
        .attr('class','subtitle')
        .attr("x", w*(4.9/7))
        .attr("y", h*(4.12/6))
        .text('Better half')
        ;
    
        map
        .append('text')
        .attr('class','subtitle')
        .attr("x", w*(4.9/7))
        .attr("y", h*(4.4/6))
        .text('Worse half')
        ;





});

//DROPPED THE STATE MAP LATER FROM THE CODE

/*
d3.json("maps/state_map.json", function(json){

var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)            
            .style("fill", 'white')
            .style('fill-opacity','1')            
            .style("stroke", "#fff")
            .style("stroke-width", "2px")
            .style("opacity","0")
            .transition()
            .delay(500)
            .duration(1000)
            .style("opacity","1")
            ;
});
*/

var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var svg_diag = svg
                .append('svg')
                .attr('y', h/8)
                .attr('x', w*(4/5))
                .attr("width", h/4)
                .attr("height", w/6)
                .attr('id','svg_diag')
                ;

d3.xml("images/drawing_min.svg", function(error, xml) {
if (error) {console.log(error); return;}

			var svg_node = xml
                .getElementsByTagName("svg")[0]
                ;

			svg_diag
					  .node()
					  .appendChild(svg_node)
					  ;
		
svg_diag
		.select("#circle1")
		.attr("fill", "#caf270")
    //.attr("fill", "#30b096")
    //.attr('stroke','#caf270')
		.attr("fill-opacity","0")
    //.attr('stroke-width','1px')
    .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
			.attr("fill-opacity","1")
      .attr('stroke-opacity','1')
		;

    svg_diag
		.select("#circle2")
    //.attr('stroke','#caf270')
    //.attr('stroke-width','1px')
    .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
		;

    svg_diag
		.select("#circle3")
    //.attr('stroke','#caf270')
    //.attr('stroke-width','1px')
    .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
		;

    svg_diag
		.select("#intersection")
    //.attr('stroke','#caf270')
    //.attr('stroke-width','1px')
    .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
		;


		});



}

function sec_3(){ 

      canvas_clear();

      function wrap(text, width) {
  text.each(function() {
    var text = d3.select(this),
        words = text.text().split(/\s+/).reverse(),
        word,
        line = [],
        lineNumber = 0,
        lineHeight = 1.1, // ems
        x = text.attr("0"),
        y = text.attr("y"),
        dy = 0, //parseFloat(text.attr("dy")),
        tspan = text.text(null)
                    .append("tspan")
 //                   .attr("x", 10)
//                    .attr("x", x)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", dy + "em")
                    ;
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text
                    .append("tspan")
                    //.attr("x", 50)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", ++lineNumber * lineHeight + dy + "em")
                    .text(word)
                    ;
      }
    }
  });
}

svg
    .append('text')
    .attr('class','title')
    .attr('y', 20)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("MAPPING HIGH BP IN RURAL ADULTS")
    //.call(wrap, 400)
    .transition()
    .duration(3000)
    .attr('opacity','1')
    
    ;

    svg
    .append('text')
  .attr('class','subtitle')
    .attr('y', 37)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("Hover over a district for more details")
    //.call(wrap, 400)
    .transition()
    .duration(3000)
    .attr('opacity','1')
    ;

      d3.json("maps/district_map_merged.json", function(json){

        var format = d3.format(".2n");


//code for tooltip from http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f

  var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([75, 150])
            .html(function(d) {
              return "<strong>District: </strong>" + "<span class='details'>" + d.properties.district + "</span><br>" + "<strong>State: </strong>" + "<span class='details'>" + d.properties.state + "</span><br>" + "<strong>Rural men with high BP: </strong>" + "<span class='details'>" + format(d.properties.rural_BPM) +"%</span><br>"+ "<strong>Rural women with high BP: </strong>" + "<span class='details'>" + format(d.properties.rural_BPW) +"%</span>";
            })
            ;        

var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

              map.call(tip);


      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            .style("stroke", "#fff")
            .style("fill-opacity","1")
            .style("stroke-width", "0px")
            
               .on('mouseover',function(d){
                if( d.properties.rural_BP_show === 'yes'){
                         tip.show(d);

                          d3.select(this)
                            //.style("opacity", 1)
                            .style("stroke","#fff")
                            .style("stroke-width","2px");
                }
                        })
        .on('mouseout', function(d){
          if( d.properties.rural_BP_show === 'yes'){

                         tip.hide(d);

                          d3.select(this)
                            //.style("opacity", 0.8)
                            .style("stroke","#fff")
                            .style("stroke-width","0px");
          }
        })
        .style('fill','#caf270')
        .transition()
                  .delay(function(d,i){console.log(i,d); return i * 3})
                  .style("fill", function(d) {
              if( d.properties.rural_BP_show === 'yes'){
				    	      return '#30b096';
				     } else {
				    	return '#caf270';	}					
               })
            ;

    map.selectAll('circle')
        .data(json.features)
        .enter()
        .append('circle')
        .each(function(d) {
          if (d.properties.district !== 'Tawang') {
            return;
          }
          d3.select(this)
            .attr("r", 4)
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr("fill", "none")
            .attr("stroke", "#3a403d")
            .attr("stroke-width", 2)
            .attr('stroke-opacity',0)
            .transition()
            .duration(3000)
            .attr('stroke-opacity',1)
            ;
        })
        ;

    map.selectAll('circle')
        .data(json.features)
        .enter()
        .append('circle')
        .each(function(d) {
          if (d.properties.district !== 'Tawang') {
            return;
          }
          d3.select(this)
            .attr("r", 4)
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr("fill", "none")
            .attr("stroke", "#3a403d")
            .attr("stroke-width", 2)
            .attr('stroke-opacity',0)
            .transition()
            .duration(3000)
            .attr('stroke-opacity',1)
            ;
        })
        ;

        map.selectAll('text')
        .data(json.features)
        .enter()
        .append('text')
        .each(function(d) {
          if (d.properties.district !== 'Tawang') {
            return;
          }
          d3.select(this)
            .style('font-weight','normal')
            .style('font-size','14px')
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr('dy','-10px')
            .style('text-anchor','end')
            .attr('opacity','0')
            .text(function(d){return d.properties.district})
            .transition()
            .duration(3000)
            .attr('opacity','1')
            ;
        })
        ;

        map
        .append("rect")
          .attr("rx", 5)
          .attr("ry", 5)
          .attr("x", w*(4.5/7))
          .attr("y", h*(2/3))
          .attr("width", w/20)
          .attr("height", h/40)
          .style("fill", '#caf270')
          .attr('fill-opacity',1)
         ;
      
      map
        .append("rect")
          .attr("rx", 5)
          .attr("ry", 5)
          .attr("x", w*(4.5/7))
          .attr("y", h*(4.25/6))
          .attr("width", w/20)
          .attr("height", h/40)
          .style("fill", '#30b096')
          .attr('fill-opacity',1)
         ;
      
      map
              .append('text')
              .attr('class','subtitle')
              .attr("x", w*(4.9/7))
              .attr("y", h*(4.12/6))
              .text('Better half')
              ;
          
              map
              .append('text')
              .attr('class','subtitle')
              .attr("x", w*(4.9/7))
              .attr("y", h*(4.4/6))
              .text('Worse half')
              ;
      


});


/*
d3.json("maps/state_map.json", function(json){

var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            .style("stroke", "black")
            .style("opacity","1")
            .style("stroke-width", "1px")
            .style("fill", 'orange')
            .style('fill-opacity','0')
            ;
});
*/

var margin = {top: 50, right: 15, bottom: 5, left: 15},
w = +svg.attr("width") - margin.left - margin.right,
h = +svg.attr("height") - margin.top - margin.bottom;

var svg_diag = svg
            .append('svg')
            .attr('y', h/8)
            .attr('x', w*(4/5))
            .attr("width", h/4)
            .attr("height", w/6)
            .attr('id','svg_diag')
            ;

d3.xml("images/drawing_min_2.svg", function(error, xml) {
if (error) {console.log(error); return;}

			var svg_node = xml
                .getElementsByTagName("svg")[0]
                ;

			svg_diag
					  .node()
					  .appendChild(svg_node)
					  ;

            svg_diag
		.select("#circle1")
	  .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
	      .attr('stroke-opacity','1')
		;

            svg_diag
		.select("#circle2")
    .attr('stroke-opacity','0')
		.attr("fill", "#caf270")
	
  	.attr("fill-opacity","0")
  
  	.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
			.attr("fill-opacity","1")
  	;

  
    svg_diag
		.select("#circle3")
    .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
		;

    svg_diag
		.select("#intersection")
    .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
		;


		});


}


function sec_4(){ 

      canvas_clear();

      function wrap(text, width) {
  text.each(function() {
    var text = d3.select(this),
        words = text.text().split(/\s+/).reverse(),
        word,
        line = [],
        lineNumber = 0,
        lineHeight = 1.1, // ems
        x = text.attr("0"),
        y = text.attr("y"),
        dy = 0, //parseFloat(text.attr("dy")),
        tspan = text.text(null)
                    .append("tspan")
 //                   .attr("x", 10)
//                    .attr("x", x)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", dy + "em")
                    ;
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text
                    .append("tspan")
                    //.attr("x", 50)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", ++lineNumber * lineHeight + dy + "em")
                    .text(word)
                    ;
      }
    }
  });
}

svg
    .append('text')
    .attr('class','title')
    .attr('y', 20)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("MAPPING HIGH BLOOD SUGAR IN RURAL ADULTS")
    //.call(wrap, 400)
    .transition()
    .duration(3000)
    .attr('opacity','1')
    
    ;

    svg
    .append('text')
  .attr('class','subtitle')
    .attr('y', 37)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("Hover over a district for more details")
    //.call(wrap, 400)
    .transition()
    .duration(3000)
    .attr('opacity','1')
    ;

      d3.json("maps/district_map_merged.json", function(json){

        var format = d3.format(".2n");


//code for tooltip from http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f

  var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([75, 150])
            .html(function(d) {
              return "<strong>District: </strong>" + "<span class='details'>" + d.properties.district + "</span><br>" + "<strong>State: </strong>" + "<span class='details'>" + d.properties.state + "</span><br>" + "<strong>Rural men with high blood sugar: </strong>" + "<span class='details'>" + format(d.properties.rural_SUGM) +"%</span><br>"+ "<strong>Rural women with high blood sugar: </strong>" + "<span class='details'>" + format(d.properties.rural_SUGW) +"%</span>";
            })
            ;


var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

              map.call(tip);

      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            .style("stroke", "#3a403d")
            .style("fill-opacity","1")
            .style("stroke-width", "0px")
            
               .on('mouseover',function(d){
                if( d.properties.rural_SUG_show === 'yes'){
                         tip.show(d);

                          d3.select(this)
                            //.style("opacity", 1)
                            .style("stroke","#fff")
                            .style("stroke-width","2px");
                }
                        })
        .on('mouseout', function(d){
          if( d.properties.rural_SUG_show === 'yes'){

                         tip.hide(d);

                          d3.select(this)
                            //.style("opacity", 0.8)
                            .style("stroke","#fff")
                            .style("stroke-width","0px");
          }
        })
        .style('fill','#caf270')
        .transition()
                  .delay(function(d,i){console.log(i,d); return i * 3})
                  .style("fill", function(d) {
              if( d.properties.rural_SUG_show === 'yes'){
				    	      return '#30b096';
				     } else {
				    	return '#caf270';	}					
               })
               ;

               map.selectAll('circle')
        .data(json.features)
        .enter()
        .append('circle')
        .each(function(d) {
          if (d.properties.district !== 'Kannur') {
            return;
          }
          d3.select(this)
            .attr("r", 4)
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr("fill", "none")
            .attr("stroke", "#3a403d")
            .attr("stroke-width", 2)
            .attr('stroke-opacity',0)
            .transition()
            .duration(3000)
            .attr('stroke-opacity',1)
            ;
        })
        ;

        map.selectAll('text')
        .data(json.features)
        .enter()
        .append('text')
        .each(function(d) {
          if (d.properties.district !== 'Kannur') {
            return;
          }
          d3.select(this)
            .style('font-weight','normal')
            .style('font-size','14px')
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr('dx','-10px')
            .style('text-anchor','end')
            .attr('opacity','0')
            .text(function(d){return d.properties.district})
            .transition()
            .duration(3000)
            .attr('opacity','1')
            ;
        })
        ;

        map
        .append("rect")
          .attr("rx", 5)
          .attr("ry", 5)
          .attr("x", w*(4.5/7))
          .attr("y", h*(2/3))
          .attr("width", w/20)
          .attr("height", h/40)
          .style("fill", '#caf270')
          .attr('fill-opacity',1)
         ;
      
      map
        .append("rect")
          .attr("rx", 5)
          .attr("ry", 5)
          .attr("x", w*(4.5/7))
          .attr("y", h*(4.25/6))
          .attr("width", w/20)
          .attr("height", h/40)
          .style("fill", '#30b096')
          .attr('fill-opacity',1)
         ;
      
      map
              .append('text')
              .attr('class','subtitle')
              .attr("x", w*(4.9/7))
              .attr("y", h*(4.12/6))
              .text('Better half')
              ;
          
              map
              .append('text')
              .attr('class','subtitle')
              .attr("x", w*(4.9/7))
              .attr("y", h*(4.4/6))
              .text('Worse half')
              ;
      


});

/*
d3.json("maps/state_map.json", function(json){



var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;


      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            .style("stroke", "black")
            .style("opacity","1")
            .style("stroke-width", "1px")
            .style("fill", 'orange')
            .style('fill-opacity','0')
            ;
});
*/

var margin = {top: 50, right: 15, bottom: 5, left: 15},
w = +svg.attr("width") - margin.left - margin.right,
h = +svg.attr("height") - margin.top - margin.bottom;

var svg_diag = svg
            .append('svg')
            .attr('y', h/8)
            .attr('x', w*(4/5))
            .attr("width", h/4)
            .attr("height", w/6)
            .attr('id','svg_diag')
            ;

d3.xml("images/drawing_min_3.svg", function(error, xml) {
if (error) {console.log(error); return;}

			var svg_node = xml
                .getElementsByTagName("svg")[0]
                ;

			svg_diag
					  .node()
					  .appendChild(svg_node)
					  ;

            svg_diag
		.select("#circle1")
	  .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
	      .attr('stroke-opacity','1')
		;

            svg_diag
		.select("#circle2")
    .attr('stroke-opacity','0')
  	.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
  	;

  
    svg_diag
		.select("#circle3")
    .attr('stroke-opacity','0')
		.attr("fill", "#caf270")
  	.attr("fill-opacity","0")

		.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
			.attr("fill-opacity","1")

		;

    svg_diag
		.select("#intersection")
    .attr('stroke-opacity','0')
		.transition()
			.duration(3000)
      .attr('stroke-opacity','1')
		;


		});




}



function sec_5(){ 

      canvas_clear();

      function wrap(text, width) {
  text.each(function() {
    var text = d3.select(this),
        words = text.text().split(/\s+/).reverse(),
        word,
        line = [],
        lineNumber = 0,
        lineHeight = 1.1, // ems
        x = text.attr("0"),
        y = text.attr("y"),
        dy = 0, //parseFloat(text.attr("dy")),
        tspan = text.text(null)
                    .append("tspan")
 //                   .attr("x", 10)
//                    .attr("x", x)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", dy + "em")
                    ;
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text
                    .append("tspan")
                    //.attr("x", 50)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", ++lineNumber * lineHeight + dy + "em")
                    .text(word)
                    ;
      }
    }
  });
}

svg
    .append('text')
    .attr('class','title')
    .attr('y', 20)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("THE DISTRICTS PRESENT IN ALL THREE MAPS")
    //.call(wrap, 400)
    .transition()
    .duration(1500)
    .attr('opacity','1')
    
    ;

    svg
    .append('text')
  .attr('class','subtitle')
    .attr('y', 37)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("Hover over a district for more details")
    //.call(wrap, 400)
    .transition()
    .duration(3000)
    .attr('opacity','1')
    ;

      d3.json("maps/district_map_merged.json", function(json){

        var format = d3.format(".2n");

//code for tooltip from http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f

  var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([100, 175])
            .html(function(d) {
              return "<strong>District: </strong>" + "<span class='details'>" + d.properties.district + "</span><br>" + "<strong>State: </strong>" + "<span class='details'>" + d.properties.state + "</span><br>" + "<strong>Rural men with high BMI: </strong>" + "<span class='details'>" + format(d.properties.rural_BMIM) +"%</span><br>" + "<strong>Rural men with high BP: </strong>" + "<span class='details'>" + format(d.properties.rural_BPM) +"%</span><br>" + "<strong>Rural men with high blood sugar: </strong>" + "<span class='details'>" + format(d.properties.rural_SUGM) +"%</span><br>" + "<strong>Rural women with high BMI: </strong>" + "<span class='details'>" + format(d.properties.rural_BMIW) +"%</span><br>" + "<strong>Rural women with high BP: </strong>" + "<span class='details'>" + format(d.properties.rural_BPW) +"%</span><br>" + "<strong>Rural women with high blood sugar: </strong>" + "<span class='details'>" + format(d.properties.rural_SUGW) +"%</span>";
            })
            ;


var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

              map.call(tip);

      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            //.style("stroke", "#3a403d")
            .style("fill-opacity","1")
            .style("stroke-width", "0px")
            
               .on('mouseover',function(d){
                if( d.properties.rural_ALL_show === 'yes'){
                         tip.show(d);

                          d3.select(this)
                            //.style("opacity", 1)
                            .style("stroke","#fff")
                            .style("stroke-width","2px");
                }
                        })
        .on('mouseout', function(d){
          if( d.properties.rural_ALL_show === 'yes'){

                         tip.hide(d);

                          d3.select(this)
                            //.style("opacity", 0.8)
                            .style("stroke","#fff")
                            .style("stroke-width","0px");
          }
        })
        .style('fill','#caf270')
        .transition()
                  .delay(function(d,i){console.log(i,d); return i * 3})
                  .style("fill", function(d) {
              if( d.properties.rural_ALL_show === 'yes'){
				    	      return '#30b096';
				     } else {
				    	return '#caf270';	}					
               })
            ;

map
  .append("rect")
    .attr("rx", 10)
    .attr("ry", 10)
    //.attr("x", 103)
    //.attr("y", 75)
    .attr('x',w/4.5)
    .attr('y',h/6)
    .attr("width", w/8)
    .attr("height", h/10)
    .style("fill", 'none')
    .attr("stroke", "#3a403d")
    .attr("stroke-width", 2)
    .attr('stroke-dasharray',3)
    .attr('stroke-opacity',0)
            .transition()
            .duration(3000)
            .attr('stroke-opacity',1)
            ;

/*
            map
  .append("rect")
    .attr("rx", 5)
    .attr("ry", 5)
    .attr("x", 303)
    .attr("y", 290)
    .attr("width", 20)
    .attr("height", 10)
    .style("fill", '#caf270')
    .attr('fill-opacity',1)
   ;

map
  .append("rect")
    .attr("rx", 5)
    .attr("ry", 5)
    .attr("x", 303)
    .attr("y", 310)
    .attr("width", 20)
    .attr("height", 10)
    .style("fill", '#30b096')
    .attr('fill-opacity',1)
   ;

map
        .append('text')
        .attr('class','subtitle')
        .attr("x", 325)
        .attr("y", 300)
        .text('Better half')
        ;
    
        map
        .append('text')
        .attr('class','subtitle')
        .attr("x", 325)
        .attr("y", 320)
        .text('Worse half')
        ;
*/

/*
    map.selectAll('circle')
        .data(json.features)
        .enter()
        .append('circle')
        .each(function(d) {
          if (d.properties.district !== 'Firozpur') {
            return;
          }
          d3.select(this)
            .attr("r", 4)
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr("fill", "none")
            .attr("stroke", "#3a403d")
            .attr("stroke-width", 2)
            .attr('stroke-opacity',0)
            .transition()
            .duration(3000)
            .attr('stroke-opacity',1)
            ;
        })
        ;

        map.selectAll('text')
        .data(json.features)
        .enter()
        .append('text')
        .each(function(d) {
          if (d.properties.district !== 'Firozpur') {
            return;
          }
          d3.select(this)
            .style('font-weight','normal')
            .style('font-size','14px')
            .attr("transform", function(d) { return "translate(" + pathx.centroid(d) + ")"; })
            .attr('dx','-10px')
            .style('text-anchor','end')
            .attr('opacity','0')
            .text(function(d){return d.properties.district})
            .transition()
            .duration(3000)
            .attr('opacity','1')
            ;
        })
        ;
*/




});

/*
d3.json("maps/state_map.json", function(json){

var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            .style("stroke", "#3a403d")
            .style("opacity","1")
            .style("stroke-width", "1px")
            .style("fill", 'orange')
            .style('fill-opacity','0')
            ;
});
*/

var margin = {top: 50, right: 15, bottom: 5, left: 15},
w = +svg.attr("width") - margin.left - margin.right,
h = +svg.attr("height") - margin.top - margin.bottom;

var svg_diag = svg
            .append('svg')
            .attr('y', h/8)
            .attr('x', w*(4/5))
            .attr("width", h/4)
            .attr("height", w/6)
            .attr('id','svg_diag')
            ;

d3.xml("images/drawing_min_4.svg", function(error, xml) {
if (error) {console.log(error); return;}

			var svg_node = xml
                .getElementsByTagName("svg")[0]
                ;

			svg_diag
					  .node()
					  .appendChild(svg_node)
					  ;

            svg_diag
		.select("#circle1")
	  .attr('stroke-opacity','0')
		.transition()
			.duration(1500)
	      .attr('stroke-opacity','1')
		;

            svg_diag
		.select("#circle2")
    .attr('stroke-opacity','0')
  	.transition()
			.duration(1500)
      .attr('stroke-opacity','1')
  	;

  
    svg_diag
		.select("#circle3")
    .attr('stroke-opacity','0')

		.transition()
			.duration(1500)
      .attr('stroke-opacity','1')
		;

    svg_diag
		.select("#intersection")
    .attr('stroke-opacity','0')
		.attr("fill", "#caf270")
  	.attr("fill-opacity","0")

		.transition()
			.duration(1500)
      .attr('stroke-opacity','1')
      .attr("fill-opacity","1")

		;


		});



}


function sec_6(){ 
   
         canvas_clear();

         function wrap(text, width) {
  text.each(function() {
    var text = d3.select(this),
        words = text.text().split(/\s+/).reverse(),
        word,
        line = [],
        lineNumber = 0,
        lineHeight = 1.1, // ems
        x = text.attr("0"),
        y = text.attr("y"),
        dy = 0, //parseFloat(text.attr("dy")),
        tspan = text.text(null)
                    .append("tspan")
 //                   .attr("x", 10)
//                    .attr("x", x)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", dy + "em")
                    ;
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text
                    .append("tspan")
                    //.attr("x", 50)
                    .attr("x", (+svg.attr("width") - width)/2)
                    .attr("y", y)
                    .attr("dy", ++lineNumber * lineHeight + dy + "em")
                    .text(word)
                    ;
      }
    }
  });
}

svg
    .append('text')
    .attr('class','title')
    .attr('y', 20)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("MAPPING THE 3 CONDITIONS IN PUNJAB & HP")
    //.call(wrap, 400)
    .transition()
    .duration(1000)
    .attr('opacity','1')
    ;

    svg
    .append('text')
  .attr('class','subtitle')
    .attr('y', 37)
    .attr('x', width/2)
    .attr('opacity','0')
    .style("text-anchor", "middle" )
    .text("Hover over a district for more details")
    //.call(wrap, 400)
    .transition()
    .duration(1000)
    .attr('opacity','1')
    ;


         d3.json("maps/hp_punjab.json", function(json){

        var format = d3.format(".2n");

//code for tooltip from http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f

  var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([125, 175])
            .html(function(d) {
              return "<strong>District: </strong>" + "<span class='details'>" + d.properties.district + "</span><br>" + "<strong>State: </strong>" + "<span class='details'>" + d.properties.state + "</span><br>" + "<strong>Rural men with high BMI: </strong>" + "<span class='details'>" + format(d.properties.rural_BMIM) +"%</span><br>" + "<strong>Rural men with high BP: </strong>" + "<span class='details'>" + format(d.properties.rural_BPM) +"%</span><br>" + "<strong>Rural men with high blood sugar: </strong>" + "<span class='details'>" + format(d.properties.rural_SUGM) +"%</span><br>" + "<strong>Rural women with high BMI: </strong>" + "<span class='details'>" + format(d.properties.rural_BMIW) +"%</span><br>" + "<strong>Rural women with high BP: </strong>" + "<span class='details'>" + format(d.properties.rural_BPW) +"%</span><br>" + "<strong>Rural women with high blood sugar: </strong>" + "<span class='details'>" + format(d.properties.rural_SUGW) +"%</span>";
            })
            ;


var margin = {top: 50, right: 15, bottom: 5, left: 15},
    w = +svg.attr("width") - margin.left - margin.right,
    h = +svg.attr("height") - margin.top - margin.bottom;

var map = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("width", w)
        .attr("height", h)
        ;

var proj = d3
      .geoMercator()
      .fitSize([w, h], json)
      ;

var pathx = d3
              .geoPath()
              .projection(proj)
              ;

              map.call(tip);

      map
        .selectAll("path")
        .data(json.features)
        .enter()
            .append("path")
            .attr("d", pathx)
            //.style("stroke", "#3a403d")
            .style("fill-opacity","1")
            .style("stroke","#fff")
            .style("stroke-width", "0.5px")
            
            .style("fill", function(d) {
              if( d.properties.rural_ALL_show === 'yes'){
				    	      return '#30b096';
				     } else {
				    	return '#caf270';	}					
               })
               .on('mouseover',function(d){
                if( d.properties.rural_ALL_show === 'yes'){
                         tip.show(d);

                          d3.select(this)
                            //.style("opacity", 1)
                            .style("stroke","#fff")
                            .style("stroke-width","3px");
                }
                        })
        .on('mouseout', function(d){
          if( d.properties.rural_ALL_show === 'yes'){

                         tip.hide(d);

                          d3.select(this)
                            //.style("opacity", 0.8)
                            .style("stroke","#fff")
                            .style("stroke-width","0.5px");
          }
        })
        ;


    map
	    .selectAll(".district_label")
	    .data(json.features)
	    .enter()
	    .append("text")
      .attr('classed','district_label')
	    //.style('font-weight','normal')
      .style('font-size','14px')
      .attr("transform", function (d) { return "translate(" + pathx.centroid(d) + ")"; })
	    .style('text-anchor',function(d){
        if(d.properties.district === 'Tarn Taran'){
          return 'end'
        }
        else{
          return 'start'
        }
      })
      .on('mouseover',function(d){
                if( d.properties.rural_BMI_show === 'yes'){
                         tip.show(d);
                 
                }
                        })
        .on('mouseout', function(d){
          if( d.properties.rural_BMI_show === 'yes'){

                         tip.hide(d);
          }
        })
      .attr('opacity','0')
      .text(function(d){
        if( d.properties.rural_ALL_show === 'yes'){
          return d.properties.district 
          //+ '(' + d.properties.state + ')'
          }
	    })
    .transition()
    .duration(1000)
    .attr('opacity','1')
	    ;
});




}



  var gs = d3.graphScroll()
      .container(d3.select('#container'))
      .graph(d3.selectAll('#graph'))
      .sections(d3.selectAll('#sections > div'))
      // .offset(innerWidth < 900 ? innerHeight - 30 : 200)
      .eventId('uniqueId1')
      .on('active', function(i){  
              
              [ 
                sec_1,
                sec_2,
                sec_3,
                sec_4,
                sec_5,
                sec_6
                       ][i]();

})

//the brace above is completed by the brace appearing before the list of function names

}
//this is the brace that closes the render function

render()
d3.select(window).on('resize', render)

</script>

</body>

</html>
